<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.text.*?>
<?import javafx.geometry.*?>
<?import javafx.scene.image.ImageView?>

<BorderPane xmlns:fx="http://javafx.com/fxml" fx:controller="Controllers.Back.ReclamationController"
           stylesheets="/styles/theme.css"
           minWidth="900" minHeight="600" prefHeight="800.0" prefWidth="1200.0"
           fx:id="mainContainer">

    <!-- BARRE MAUVE EN HAUT (sans titre Ã  gauche) -->
    <top>
        <HBox style="-fx-background-color: #6C5CE7; -fx-padding: 18 30 18 30;" alignment="CENTER_LEFT" spacing="20">
            <Region HBox.hgrow="ALWAYS" />
            <Label text="Admin Dashboard" style="-fx-font-size: 16px; -fx-text-fill: white;"/>
        </HBox>
    </top>

    <!-- Barre latÃ©rale -->
    <left>
        <VBox styleClass="admin-sidebar">
            <padding>
                <Insets top="20" right="15" bottom="20" left="15"/>
            </padding>

            <Label text="Menu Principal" styleClass="sidebar-title"/>

            <VBox styleClass="menu-items" spacing="15">
                <Button text="Tableau de bord" styleClass="menu-item, menu-item-active"/>
                <Button text="RÃ©clamations" styleClass="menu-item"/>
                <Button text="RÃ©ponses" styleClass="menu-item"/>
                <Button text="Messagerie" onAction="#showMessagerie" styleClass="menu-item"/>
                <Button text="Statistiques" onAction="#handleStatistiques" styleClass="menu-item"/>
                <!--  Ajout du bouton Messenger flottant
                <StackPane maxWidth="54" maxHeight="54" minWidth="54" minHeight="54" style="-fx-alignment: TOP_RIGHT; -fx-background-color: #fffbe6; -fx-border-color: #ff0000; -fx-border-width: 2;">
                    <Button fx:id="floatingMessengerButton" text="ðŸ’¬"
                            style="-fx-background-radius: 50%; -fx-background-color: #0084ff; -fx-text-fill: white; -fx-font-size: 22px; -fx-pref-width: 54; -fx-pref-height: 54; -fx-cursor: hand; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.2), 8, 0, 0, 3);" />
                    <Label fx:id="messengerBadgeLabel" visible="false"
                           style="-fx-background-color: red; -fx-text-fill: white; -fx-font-size: 11px; -fx-font-weight: bold; -fx-padding: 1 6 1 6; -fx-background-radius: 10; -fx-border-radius: 10; -fx-translate-x: 18; -fx-translate-y: -16;" />
                </StackPane> -->
            </VBox>

            <Region VBox.vgrow="ALWAYS"/>

            <Button text="DÃ©connexion" onAction="#handleRetourHome" styleClass="menu-item, menu-item-logout"/>
        </VBox>
    </left>
    <!-- Fin barre latÃ©rale -->

    <!-- Contenu principal -->
    <center>
        <StackPane>
            <ScrollPane fx:id="mainScrollPane" fitToWidth="true" styleClass="main-scroll">
                <VBox spacing="25">
                    <padding>
                        <Insets top="30" right="40" bottom="30" left="40"/>
                    </padding>

                    <!-- Barre de recherche et tri -->
                    <VBox spacing="20" styleClass="search-section">
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <VBox spacing="5">
                                <Label text="Rechercher" styleClass="field-label"/>
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <ComboBox fx:id="searchCriteriaBox" prefWidth="150" promptText="CritÃ¨re de recherche"/>
                                    <TextField fx:id="searchField" promptText="Rechercher..." styleClass="search-field" prefWidth="300" minWidth="200" maxWidth="400"/>
                                </HBox>
                            </VBox>
                            <Region HBox.hgrow="ALWAYS" />
                            <VBox spacing="5">
                                <Label text="Trier" styleClass="field-label"/>
                                <HBox spacing="10" alignment="CENTER_RIGHT">
                                    <ComboBox fx:id="sortCriteriaBox" prefWidth="150" promptText="Trier par"/>
                                    <ComboBox fx:id="sortOrderBox" prefWidth="120" promptText="Ordre"/>
                                </HBox>
                            </VBox>
                        </HBox>
                        <Separator/>
                    </VBox>

                    <!-- Liste des rÃ©clamations -->
                    <VBox fx:id="cardContainer" spacing="16" VBox.vgrow="ALWAYS">
                        <Label text="Liste des RÃ©clamations" styleClass="section-title"/>
                        <TableView fx:id="reclamationsTableView" VBox.vgrow="ALWAYS" styleClass="custom-table">
                            <columns>
                                <TableColumn fx:id="colA" text="ID" />
                                <TableColumn fx:id="colB" text="Utilisateur" />
                                <TableColumn fx:id="colC" text="Sujet" />
                                <TableColumn fx:id="colD" text="Description" />
                                <TableColumn fx:id="colE" text="Date" />
                                <TableColumn fx:id="colF" text="Statut" />
                            </columns>
                            <columnResizePolicy>
                                <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                            </columnResizePolicy>
                        </TableView>
                    </VBox>
                    <HBox spacing="10" alignment="CENTER" style="-fx-padding: 10 0 0 0;">
                        <Button fx:id="btnPrevPage" text="PrÃ©cÃ©dent" onAction="#handlePrevPage" />
                        <Label fx:id="lblPageInfo" text="Page 1 sur 1" style="-fx-font-size: 14px; -fx-font-weight: bold;" />
                        <Button fx:id="btnNextPage" text="Suivant" onAction="#handleNextPage" />
                    </HBox>

                    <!-- TEST GOOGLE SHEETS API -->
                    <VBox spacing="10" style="-fx-background-color: #f8f8ff; -fx-padding: 20;">
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <Button fx:id="btnLireSheets" text="Lire Google Sheets" onAction="#onLireSheetsClicked"/>
                            <Button fx:id="btnExporterSheet" text="Exporter vers Google Sheets" onAction="#onExporterSheetClicked" styleClass="btn-primary" />
                        </HBox>
                        <TableView fx:id="tableSheets" prefHeight="200.0" prefWidth="600.0">
                            <columns>
                                <TableColumn fx:id="colA" text="ID"/>
                                <TableColumn fx:id="colB" text="Utilisateur"/>
                                <TableColumn fx:id="colC" text="Sujet"/>
                                <TableColumn fx:id="colD" text="Description"/>
                                <TableColumn fx:id="colE" text="Date"/>
                                <TableColumn fx:id="colF" text="Statut"/>
                            </columns>
                        </TableView>
                    </VBox>

                    <!-- Section rÃ©ponses -->
                    <VBox fx:id="gestionReponseZone" spacing="15" styleClass="content-section" visible="false" managed="false">
                        <Label text="Gestion des RÃ©ponses" styleClass="section-title"/>

                        <HBox spacing="15" styleClass="status-section">
                            <Label text="Statut:" styleClass="field-label"/>
                            <ComboBox fx:id="statutComboBox" prefWidth="200"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="Actualiser" styleClass="btn-secondary"/>
                        </HBox>

                        <Separator/>

                        <VBox fx:id="reponseZone" spacing="10" visible="false" managed="false">
                            <Label text="Nouvelle RÃ©ponse" styleClass="subsection-title"/>
                            <TextArea fx:id="reponseField" promptText="Ã‰crivez votre rÃ©ponse ici..."
                                     wrapText="true" prefRowCount="3"/>
                            <HBox spacing="10" alignment="CENTER_RIGHT">
                                <Button text="Envoyer" onAction="#handleEnvoyerReponse" styleClass="btn-primary"/>
                                <Button text="Annuler" onAction="#handleAnnulerModification" styleClass="btn-secondary" prefHeight="32"/>
                            </HBox>
                        </VBox>

                        <Separator/>

                        <VBox spacing="10">
                            <Label text="Historique des RÃ©ponses" styleClass="subsection-title"/>
                            <TableView fx:id="reponsesTableView" prefHeight="250" styleClass="custom-table">
                                <columns>
                                    <TableColumn fx:id="reponseContenuColumn" text="Contenu" prefWidth="500"/>
                                    <TableColumn fx:id="reponseDateColumn" text="Date" prefWidth="150"/>
                                </columns>
                                <columnResizePolicy>
                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                                </columnResizePolicy>
                            </TableView>

                            <HBox spacing="15" alignment="CENTER_RIGHT">
                                <padding>
                                    <Insets top="10" />
                                </padding>
                                <Button fx:id="modifierReponseButton" text="Modifier" onAction="#handleEnvoyerReponse" styleClass="btn-success" prefHeight="32"/>
                                <Button fx:id="supprimerReponseButton" text="Supprimer" onAction="#handleSupprimerReponse" styleClass="btn-danger" prefHeight="32"/>
                            </HBox>
                        </VBox>
                    </VBox>
                </VBox>
            </ScrollPane>
            <!-- Bouton Messenger flottant en bas Ã  droite -->
            <Button fx:id="floatingMessengerButton"
                    style="-fx-background-radius: 50%; -fx-background-color: #0084ff; -fx-text-fill: white; -fx-font-size: 22px; -fx-pref-width: 54; -fx-pref-height: 54; -fx-cursor: hand; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.2), 8, 0, 0, 3);"
                    text="ðŸ’¬"
                    StackPane.alignment="BOTTOM_RIGHT"
                    translateY="-32" translateX="-32"/>
            <!-- Zone d'affichage de la discussion sÃ©lectionnÃ©e -->
            <StackPane fx:id="mainMessengerContainer" visible="false" managed="false" style="-fx-background-color: white; -fx-effect: dropshadow(gaussian, #bdbdbd, 16, 0.2, 0, 2);" />
            <!-- Conteneur pour les mini-messageries flottantes, superposÃ© au-dessus du contenu principal -->
            <StackPane fx:id="miniMessengersContainer" pickOnBounds="false" style="-fx-background-color: transparent;" 
                      visible="true" managed="true" mouseTransparent="false" />
        </StackPane>
    </center>

    <!-- Ajout du panneau latÃ©ral pour la liste des discussions -->
    <right>
        <StackPane fx:id="conversationChooserContainer" visible="false" managed="false" style="-fx-background-color: #f8f8ff; -fx-effect: dropshadow(gaussian, #bdbdbd, 16, 0.2, 0, 2);">
            <!-- Le contenu de la liste des discussions sera injectÃ© ici dynamiquement -->
        </StackPane>
    </right>
</BorderPane>
